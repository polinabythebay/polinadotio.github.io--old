<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]> ><! <![endif]-->
<html lang='en'>
  <!-- <![endif] -->
  <head>
    <meta charset='utf-8'>
    <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
    <!-- Use title if it's in the page YAML frontmatter -->
    <title>Software design case studies</title>
    <meta content='' name='description'>
    <meta content='width=device-width' name='viewport'>
    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <link href="../../stylesheets/syntax-cf0aeb2f.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="../../stylesheets/application-8eb2f1aa.css" media="screen" rel="stylesheet" type="text/css" />
    <script>
      window.jQuery || document.write('<script src="/js/vendor/jquery-1.8.0.min-5ee64c85.js"><\/script>')
    </script>
    <script src='/js/plugins-d35b11c4.js'></script>
    <script src='/js/vendor/modernizr-2.6.1.min-68fdcc99.js'></script>
    <link href='http://fonts.googleapis.com/css?family=Roboto:300,400,500,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <script src="//use.typekit.net/vzo3kgo.js"></script>
    <script>try{Typekit.load();}catch(e){}</script>
    <script src='/js/article-6021ed51.js'></script>
  </head>
  <body>
    <!--[if lt IE 7]>  <![endif]-->
    <header class='header'>
      <div class='outer-container'>
        <p class='header-description pull-l'>
          <a class="focus" href="/" >Polina Soshnin</a>
          is a developer based in California.
        </p>
        <nav class='site-nav'>
          <ul class='site-nav-list'>
            <!-- %li.site-nav-item -->
            <!-- = link_to "Code", "/code" -->
            <li class='site-nav-item'>
              <a href="/writing">Writing</a>
            </li>
            <li class='site-nav-item'>
              <a href="/about">About</a>
            </li>
          </ul>
        </nav>
      </div>
    </header>
    <main class='container'>
      <section class='outer-container'>
        <section class='article-wrapper'>
          <article class='article-item'>
            <h2 class='article-title'>Software design case studies</h2>
            <small class='article-date'>May 30, 2016</small>
            <div class='article-body'>
              <p>The best way for me to think about software design is to have a discussion 
              around specific use cases and problems. </p>
              
              <h3>Table of Contents</h3>
              
              <ul>
              <li><a href="#undo">Undo button</a></li>
              <li><a href="#workerjobs">Workers and jobs</a></li>
              <li><a href="#imagepage">Images and pageloads</a></li>
              <li><a href="#audioui">Audio and UI</a></li>
              <li><a href="#multiplayer">Multiplayer</a></li>
              <li><a href="#maze">Solving a maze</a></li>
              <li><a href="#auth">Videos and authorization</a></li>
              <li><a href="#forum">Web forum</a></li>
              <li><a href="#thirdparty">Many third parties</a></li>
              <li><a href="#tracking">Tracking users</a></li>
              <li><a href="#crawler">Webcrawler</a></li>
              </ul>
              
              <p><a name="undo"></a></p>
              
              <h3>Undo button</h3>
              
              <p>You&rsquo;re writing a word processor. How might you go about implementing an 
              &ldquo;undo&rdquo; feature to reverse recent changes?</p>
              
              <p>Options:</p>
              
              <ul>
              <li>Save document in temp directory every few seconds (including a time stamp). 
              When the user clicks undo, system can load an older version of the file. You 
              can clear the files when a session ends.</li>
              <li>Whenever you enter text in the editor, save this text as a line in a history file.
              When you click undo, you can just remove the last line from the history file and then
              also remove that text from the active document.</li>
              <li>Make the document file format be a sequence of change to a base text. Each change
              is a substring of the file that has changed, and what it changed to. We
              could replay changes to get to its current state, and also follow them
              back to get to older states.</li>
              <li>A markov chain. Chain together each state of the file along with its probability. 
              When we move back, we can just select the most probable past state.</li>
              </ul>
              
              <p>Discussion:</p>
              
              <p><a name="workerjobs"></a></p>
              
              <h3>Workers and jobs</h3>
              
              <p>You&rsquo;re writing a distributed worker system that allows you to schedule jobs
              for execution at a given time in the future. What might you use to build
              the part of this system that does the scheduling?</p>
              
              <ul>
              <li>FIFO queue. Each job can include a target execution time. When a worker
              pulls a job with an execution time in the future, it can simply re-add the job
              to the back of the queue to be processed for a later time.</li>
              <li>A priority queue where each item is a job and the priority is the time when 
              it should be executed. In practice you can use a database with a priority 
              queue like data structure (ex. redis sorted set, for example).</li>
              <li>Use cron! All jobs are shell scripts on a specific server, and the system
              can simply schedule a cron job for every task. When tasks run, they can remove
              themselves from the crontab.</li>
              </ul>
              
              <p>Discussion:</p>
              
              <p><a name="imagepage"></a></p>
              
              <h3>Images and pageloads</h3>
              
              <p>You work at a large e-commerce site with a catalog of several million items
              Your designer has proposed an experimental redesign of the search page
              that reduces the size of the product images (in an effort to speed page
              loads). How might you best go about producing these millions of
              new resized images?</p>
              
              <p>Options:</p>
              
              <ul>
              <li>resize image on API request. Endpoint is slow but if result is cached
              by CDN, user will still get fast access to resized images.</li>
              <li>use a processing system like Hadoop</li>
              <li>resize images in HTML (use width and height attributes in HTML image tags)</li>
              <li>create a bash script to loop over all images on server with a image
              utility. Run this script on all servers</li>
              </ul>
              
              <p>Discussion:</p>
              
              <p><a name="audioui"></a></p>
              
              <h3>Audio and UI</h3>
              
              <p>You&rsquo;re writing a music editing app. Once a composition is done, the app
              encodes it (asynchronously) into a specified audio format (.mp3 or .ogg). 
              When the encoding is complete, you&rsquo;d like to update the UI in several places 
              within the app.</p>
              
              <p>Options</p>
              
              <ul>
              <li>Separate UI update from encoding logic so encoding system does not know about
              the UI. For example, broadcast an event. The encoding system can broadcast
              an event when a song is encoded. The UI can listen for this event and update
              the UI when it sees it.</li>
              <li>Use a factory method. The encoder will be the factory. When it is done
              with encoding the audio, the assembly line will take it to the UI elements, 
              which can update the UI before passing the composition further along.</li>
              <li>Have encoding system take a list of UI elements as parameters. When encoding
              is done, tell the UI elements to update themselves.</li>
              <li>Use a spin lock. The UI code can enter a spin lock, constantly checking 
              if the encoding is done. When it is, it can update the UI and exit the lock.
              As long as the spin lock is not on the main thread, this can work.</li>
              </ul>
              
              <p><a name="multiplayer"></a></p>
              
              <h3>Multiplayer</h3>
              
              <p>You&rsquo;re building a large multi-player game. You want 100s of players to be
              able to play against each other at the same time. You&rsquo;re going to give money
              to the best players, so it&rsquo;s important that you limit their ability to cheat.
              How might you build this?</p>
              
              <ul>
              <li>Socket.IO. Each client can open a web socket connection to the server and 
              transmit an event whenver their player moves. These events will then be emitted
              to every other player in the game. That way every client will know where
              all the other players are, and can detect when they should die
              and remove themselves from the board.</li>
              <li>A server that runs a canonical copy of the game with all players. Each client
              can also run a copy of their region of the gae and use this to 
              interpolate states between server updates. Clients would send their control
              inputs to the server (ex. timestamp) and receive updates for all
              players near them.</li>
              <li>A peer-to-peer architecture (latency of client-server version above would be
              a problem). Each player could have a list of peers near them in the game, 
              and send those peers their location every frame. You could have a voting system
              (ex. blockchain) where clients vote to resolve state conflicts and agree
              on the final version.</li>
              </ul>
              
              <p>Discussion:</p>
              
              <p><a name="maze"></a></p>
              
              <h3>Solving a Maze</h3>
              
              <p>You need to write a program to solve a maze as represented 
              by a series of ASCII characters. </p>
              
              <p>Options:</p>
              
              <ul>
              <li>The maze is a graph. Each node (space in maze) has edges to the spaces 
              beside it. They we can run BFS over this graph.</li>
              <li>Apply the left-hand rule to solve the maze. If we start at the entry point
              and always move toward the left wall if possible, we&rsquo;ll eventually get to the end.</li>
              <li>Create a priority-queue with a list of active cells (with a priority of how
              far they are from the exit). They we can just visit the highest priority cell and add
              its neighbors to the queue.</li>
              <li>Recursive function that takes a coordinate pair and recursively calls it with
              neighboring coordinate until it eventually finds the optimal path through the maze.</li>
              </ul>
              
              <p>Discussion:</p>
              
              <p><a name="auth"></a></p>
              
              <h3>Videos and authorization</h3>
              
              <p>You&rsquo;re making a video site like Netflix. Users create accounts and watch videos.
              There are many restrictions on which videos each user can watch (some may be viewable
              from a given country, others may be age restricted or require a paid account). </p>
              
              <p>Options:</p>
              
              <ul>
              <li>Token authentication. We can write a number of restriction routines in the media server.
              Users can pass tokens to the media server specifying what restrictions to apply. Tokens can be signed by the 
              backend, preventing users from changing them, and allowing the media server to enforce
              complex rules.</li>
              <li>Store info on each video in the database, and when we fetch a list of possible videos to watch for 
              a user, we only return those that they are allowed to see. This way, only videos that they 
              are allowed to watch will show up in the UI.</li>
              <li>Do verification in the web app. Have a controller that takes in the ID of the video and redirects it to the
              media file (on another server/cloud storage). This controller can verify restrictions and return a
              401 unauthorized if restrictions are not met.</li>
              <li>Upload the videos to a bunch of different S3 buckets. Videos based on certain restrictions
              live in specific buckets. That way users only know about videos in a specific bucket.</li>
              </ul>
              
              <p><a name="forum"></a></p>
              
              <h3>A web forum</h3>
              
              <p>You&rsquo;re building a web forum where users can create accounts and post messages
              on forums about a variety of subjects. How might your relational DB
              schema look like?</p>
              
              <ul>
              <li>Have a messages table that contains the text of every message and a forums
              table for each forum. Because we need many-to-many relationship between messages
              and forums, we&rsquo;ll also need an association table between the two.</li>
              <li>Use a stored procedure to pull together data we need dynamically.</li>
              <li>Have a users table with info on each user, a forums table with info on each
              forum, a messages table, a foreign key to the users table, and a foreign key
              to the forums table.</li>
              <li>A posts table with the text of every message, the name of the user, and the name
              of the forum.</li>
              </ul>
              
              <p><a name="thirdparty"></a></p>
              
              <h3>Using many 3rd party services</h3>
              
              <p>You&rsquo;re designing a distributed worker library and you would like it to be
              able to queue jobs using a number of different message queueing services 
              (ex. RabbitMQ, Amazon Simple Queue Service, ZeroMQ). What&rsquo;s a good way to 
              handle making our code work with each of these services?</p>
              
              <p>Options:</p>
              
              <ul>
              <li>Write 3 versions of the library (one for each service). That way we&rsquo;ll have simpler and
              faster code for each case.</li>
              <li>Just ensure that our functions are referentially transparent. That means the order in which
              our methods are evaluated is irrelevant. We can just run the code from all our 
              queueing services and the ones that are not set up will not cause problems.</li>
              <li>Use a global &ldquo;queueing<em>service&rdquo; variable. This will be initialized to a flag
              like &ldquo;rabbit</em>mq&rdquo; or &ldquo;amazon_sqs&rdquo;. We can then use a switch statement on this variable
              anywhere in our code to make sure we do the right thing.</li>
              <li>Design a base interface that defines how our library will interact with the queue service.
              Create several implementations of this interface. A method that runs when our library
              loads can look at config details and instantiate the correct object.</li>
              </ul>
              
              <p><a name="tracking"></a></p>
              
              <h3>Tracking users</h3>
              
              <p>You want to store the locations of 20k users as they move around, in an 
              environment where you care about read and write speed a lot
              but you don&rsquo;t mind occasionally losing data. </p>
              
              <p>Options:</p>
              
              <ul>
              <li>Use in-memory datastore like Redis or Memcached.</li>
              <li>Store locations in memory, ex. Python program that maintains an 
              unordered list of tuples (user_id, location).</li>
              <li>Use the filesystem: have a file for each user_id and write to it or read 
              from it to store new locations.</li>
              <li>Use Postgress with an index on the user_id so that it&rsquo;s fast to insert
              and remove.</li>
              </ul>
              
              <p><a name="crawler"></a></p>
              
              <h3>Building a web crawler</h3>
              
              <p>Build a web crawler to search the internet for references to My Little Pony. </p>
              
              <p>Options:</p>
              
              <ul>
              <li>Enumerate all IP addresses. Open an HTTP connection to each, request all the pages that it serves.</li>
              <li>Write a program using curl and an HTML parsing library. Script will have a start URL, download and
              parse the URL, and then recursively call itself on every link found in the page.</li>
              <li>Hadoop (MapReduce). Set up an HDFS cluster, split all URLs to be scraped between them.
              Reduce step is just combining all references from computer in the cluster.</li>
              <li>Distributed worker system with a job queue to dispatch scrapers. Each scraper takes
              a URL, downloads the page, parses it, and adds hyperlinked URLs to a database. Database tracks the last
              time that each URL was scraped, and jobs will be queued for URLs that need to be 
              scraped.</li>
              </ul>
            </div>
            <div class='article-nav'></div>
            <!-- = link_to "Back to all writing", "/writing", class: "article-nav-link button" -->
            <!-- :plain -->
            <!-- <div id="disqus_thread" class="article-comments button"></div> -->
            <!-- <script type="text/javascript"> -->
            <!-- /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */ -->
            <!-- var disqus_shortname = 'name'; // required: replace example with your forum shortname -->
            <!-- /* * * DON'T EDIT BELOW THIS LINE * * */ -->
            <!-- (function() { -->
            <!-- var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; -->
            <!-- dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; -->
            <!-- (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); -->
            <!-- })(); -->
            <!-- </script> -->
            <!-- <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> -->
          </article>
        </section>
      </section>
    </main>
  </body>
</html>

<footer class='footer'>
  <div class='outer-container'>
    <!-- %p -->
    <!-- Made with <i class="fa fa-heart"></i> and <a href="http://middlemanapp.com/" target="_blank">Middleman</a>. -->
    <!-- / , <a href="http://bourbon.io" target="_blank">Bourbon</a>, and <a href="http://neat.bourbon.io" target="_blank">Neat</a>.<br> -->
    <!-- <br> -->
    <!-- The source code is on <a href="https://github.com/polinadotio/polinadotio.github.io" target="_blank">GitHub</a>. -->
    <div class='col-2'>
      <div class='column'>
        <p>
          <!-- Get in touch: -->
          <!-- <u>psoshnin[at]gmail.com</u> -->
          <!-- <i class="fa fa-code"></i> -->
          Made with <i class="fa fa-heart"></i> and <a href="http://middlemanapp.com/" target="_blank">Middleman</a>.
          <br>
          <!-- Theme inspired by <a href="https://github.com/lisasy" target="_blank">@lisasy</a>. -->
          <!-- <br> -->
          The source code is on <a href="https://github.com/polinadotio/polinadotio.github.io" target="_blank">GitHub</a>.
        </p>
      </div>
      <div class='footer-contact column'>
        <ul class='footer-contact-list'>
          <li class='footer-contact-item'>
            <a href="http://github.com/polinadotio" target="_blank">
            <i class="fa fa-github"></i>
            </a>
          </li>
          <li class='footer-contact-item'>
            <a href="http://twitter.com/polinadotio" target="_blank">
            <i class="fa fa-twitter"></i>
            </a>
          </li>
          <li class='footer-contact-item'>
            <a href="http://www.linkedin.com/in/polinasoshnin" target="_blank">
            <i class="fa fa-linkedin"></i>
            </a>
          </li>
          <!-- %li.footer-contact-item -->
          <!-- <a href="http://stackoverflow.com/users/2150751/907code?tab=profile" target="_blank"> -->
          <!-- <i class="fa fa-stack-overflow"></i> -->
          <!-- </a> -->
        </ul>
      </div>
    </div>
  </div>
</footer>
